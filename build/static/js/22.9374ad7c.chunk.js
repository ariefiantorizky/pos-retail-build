(this.webpackJsonpPOS_RETAIL=this.webpackJsonpPOS_RETAIL||[]).push([[22],{463:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var l=a(80);function s(){const e=Object(l.d)(),{billNo:t="",billDate:a="",data:s=[]}=Object(l.e)((e=>null===e||void 0===e?void 0:e.transaction)),{cashier:n={},property:c={}}=JSON.parse(localStorage.getItem("app")||"{}"),r=()=>(null===s||void 0===s?void 0:s.reduce(((e,t)=>{let{total:a=0}=t;return+e+ +a}),0))||0,i=()=>0,d=()=>r()-0,o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return 0!==(null===e||void 0===e?void 0:e.length)?e.reduce(((e,t)=>+e+ +t.cashPay),0):0},u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const a=d(),l=o(e);return 0===a?0:t>a?t-a:l>a?l-a:0};return{getTotalQty:()=>(null===s||void 0===s?void 0:s.reduce(((e,t)=>{let{qty:a=0}=t;return+e+ +a}),0))||0,getDiscountTotal:i,getSubtotal:r,getGrandTotal:d,getCashPaid:o,getCashChange:u,getBalanceDue:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=u(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),a=o(e),l=d();return a>=l?a-l-t:d()-+a},paymentStore:(l,i)=>{var o,j;const h={header:[{billNo:t,billDate:a,custCode:"",custName:"",discPrc:"0",discValue:"0",taxPrc:"0",taxValue:"0",subTotal:r(),grandTotal:d(),shiftID:(null===n||void 0===n?void 0:n.shiftId)||"0",outletCode:null===c||void 0===c?void 0:c.outletCode}],settle:0!==(null===(o=l.settles)||void 0===o?void 0:o.length)&&(null===(j=l.settles)||void 0===j?void 0:j.map((e=>({...e,cashChange:u(null===l||void 0===l?void 0:l.settles,null===e||void 0===e?void 0:e.cashPay)})))),details:null===s||void 0===s?void 0:s.map(((e,a)=>({...e,billNo:t,ItemNo:a+1})))};e({type:"transaction/STORE",payload:h,bill:{from:a,to:a},handlePrint:()=>{if("function"===typeof i)return i()}})}}}},616:function(e,t,a){"use strict";a.d(t,"a",(function(){return j}));a(353);var l=a(355),s=(a(354),a(356)),n=a(191),c=a.n(n),r=a(1),i=a.n(r),d=a(80),o=a(108),u=a(14);const j=i.a.forwardRef(((e,t)=>{const{transactions:a=[],cash:n={},billDate:i="",billNo:j=null,paymentMethod:h="",isReprintBill:m=!1,payments:x=[]}=e,[b,p]=Object(r.useState)({}),{billNo:v}=Object(d.e)((e=>null===e||void 0===e?void 0:e.transaction)),{loading:O=!1}=Object(d.e)((e=>null===e||void 0===e?void 0:e.auth));Object(r.useEffect)((()=>{const e=JSON.parse(localStorage.getItem("app")||"{}"),{property:t={},user:a={}}=e;p({...t,cashier:(null===a||void 0===a?void 0:a.username)||""}||{})}),[t]);const f=null===a||void 0===a?void 0:a.reduce(((e,t)=>{let{total:a=0}=t;return+e+ +a}),0);return Object(u.jsx)("div",{className:"w-full h-full rounded-md mx-auto",children:Object(u.jsxs)("div",{className:"w-full h-auto bg-white p-3 py-7 mx-auto",style:{maxWidth:"350px"},ref:t,children:[O?Object(u.jsx)("p",{className:"text-left text-print-xsmall text-gray-500",children:"Memuat data..."}):Object(u.jsxs)("div",{children:[Object(u.jsx)("p",{className:"text-center text-print-medium font-bold",children:(null===b||void 0===b?void 0:b.header1)||""}),Object(u.jsx)("p",{className:"text-center text-print-small font-semibold",children:(null===b||void 0===b?void 0:b.header2)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall mt-2",children:(null===b||void 0===b?void 0:b.header3)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:(null===b||void 0===b?void 0:b.header4)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:(null===b||void 0===b?void 0:b.header5)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:(null===b||void 0===b?void 0:b.header6)||""}),m&&Object(u.jsx)("p",{className:"text-center text-print-small mt-3 font-semibold",children:"THIS IS COPY / REPRINT"})]}),Object(u.jsx)("div",{className:"my-3 w-full border border-separate border-gray-400"}),Object(u.jsxs)(l.a,{children:[Object(u.jsx)(s.a,{span:7,children:Object(u.jsx)("p",{className:"text-left text-print-xsmall",children:"Tanggal/Waktu"})}),Object(u.jsx)(s.a,{span:2,children:Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:":"})}),Object(u.jsx)(s.a,{span:15,children:Object(u.jsx)("p",{className:"text-left text-print-xsmall",children:c()(i).format("ddd, DD MMMM YYYY LTS")})})]}),Object(u.jsxs)(l.a,{className:"my-1",children:[Object(u.jsx)(s.a,{span:7,children:Object(u.jsx)("p",{className:"text-left text-print-xsmall",children:"No. Transaksi"})}),Object(u.jsx)(s.a,{span:2,children:Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:":"})}),Object(u.jsx)(s.a,{span:15,children:Object(u.jsx)("p",{className:"text-left text-print-xsmall",children:j||v||"-"})})]}),Object(u.jsxs)(l.a,{children:[Object(u.jsx)(s.a,{span:7,children:Object(u.jsx)("p",{className:"text-left text-print-xsmall",children:"Kasir"})}),Object(u.jsx)(s.a,{span:2,children:Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:":"})}),Object(u.jsx)(s.a,{span:15,children:Object(u.jsx)("p",{className:"text-left text-print-xsmall",children:(null===b||void 0===b?void 0:b.cashier)||""})})]}),Object(u.jsx)("div",{className:"my-3 w-full border border-separate border-gray-400"}),0===(null===a||void 0===a?void 0:a.length)&&Object(u.jsx)("p",{className:"text-left text-print-xsmall text-gray-500",children:"Tidak ada transaksi"}),null===a||void 0===a?void 0:a.map(((e,t)=>{let{ItemName:a="",qty:n=0,price:c=0,total:r=0}=e;return Object(u.jsxs)(l.a,{wrap:!0,gutter:[2,2],className:"mb-2",children:[Object(u.jsx)(s.a,{span:24,children:Object(u.jsx)("p",{className:"text-left text-print-xsmall",children:a||""})}),Object(u.jsx)(s.a,{span:8,children:Object(u.jsxs)("p",{className:"text-left text-print-xsmall",children:["Rp ",Object(o.a)(c||0,0)||""]})}),Object(u.jsx)(s.a,{span:8,children:Object(u.jsxs)("p",{className:"text-center text-print-xsmall",children:[n||"","x"]})}),Object(u.jsx)(s.a,{span:8,children:Object(u.jsxs)("p",{className:"text-right text-print-xsmall",children:["Rp ",Object(o.a)((r||0).toString(),0)||"0"]})})]},t)})),Object(u.jsx)("div",{className:"my-3 w-full border border-separate border-gray-400"}),0===(null===x||void 0===x?void 0:x.length)?Object(u.jsxs)(l.a,{className:"my-1",children:[Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall",children:"Pembayaran"})}),Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall uppercase",children:(h||"-").trim().toUpperCase()})})]}):null===x||void 0===x?void 0:x.map(((e,t)=>{var a,n;let{cashPay:c,tenderName:r}=e;return Object(u.jsxs)(l.a,{className:"my-1",children:[Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall capitalize",children:null===(a=r||"")||void 0===a?void 0:a.trim()})}),Object(u.jsx)(s.a,{span:12,children:Object(u.jsxs)("p",{className:"text-right text-print-xsmall uppercase",children:["Rp ",null===(n=Object(o.a)(c,0)||"")||void 0===n?void 0:n.trim()]})})]})})),Object(u.jsxs)(l.a,{className:"my-1",children:[Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall",children:"Subtotal"})}),Object(u.jsx)(s.a,{span:12,children:Object(u.jsxs)("p",{className:"text-right text-print-xsmall",children:["Rp ",Object(o.a)(f||"0",0)]})})]}),Object(u.jsxs)(l.a,{className:"my-1",children:[Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall",children:"Diskon"})}),Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall",children:"Rp 0"})})]}),Object(u.jsxs)(l.a,{className:"my-1",children:[Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall",children:"Total"})}),Object(u.jsx)(s.a,{span:12,children:Object(u.jsxs)("p",{className:"text-right text-print-xsmall",children:["Rp ",Object(o.a)(f||"0",0)]})})]}),Object(u.jsxs)(l.a,{className:"my-1",children:[Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall",children:"Bayar"})}),Object(u.jsx)(s.a,{span:12,children:Object(u.jsxs)("p",{className:"text-right text-print-xsmall",children:["Rp ",Object(o.a)((null===n||void 0===n?void 0:n.cashPaid)||"0",0)]})})]}),Object(u.jsxs)(l.a,{className:"my-1",children:[Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall",children:"Kembalian"})}),Object(u.jsx)(s.a,{span:12,children:Object(u.jsxs)("p",{className:"text-right text-print-xsmall",children:["Rp ",Object(o.a)((null===n||void 0===n?void 0:n.cashChange)||"0",0)]})})]}),O?Object(u.jsx)("p",{className:"text-left text-print-xsmall text-gray-500",children:"Memuat data..."}):Object(u.jsxs)("div",{className:"mt-7",children:[Object(u.jsx)("p",{className:"text-center text-print-xsmall font-semibold",children:(null===b||void 0===b?void 0:b.footer1)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:(null===b||void 0===b?void 0:b.footer2)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:(null===b||void 0===b?void 0:b.footer3)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:(null===b||void 0===b?void 0:b.footer4)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:(null===b||void 0===b?void 0:b.footer5)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:(null===b||void 0===b?void 0:b.footer6)||""})]})]})})}))},626:function(e,t,a){},777:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return C}));a(132);var l=a(24),s=(a(243),a(116)),n=a(1),c=a(616),r=a(80),i=a(462),d=a(470),o=a(13),u=a(108),j=(a(626),a(192),a(100)),h=(a(144),a(86)),m=a(463),x=a(14);function b(e){const t=Object(n.useRef)(),{handlePaymentStore:a=e=>{},state:l={},handleCancel:s=()=>{},open:c=!1}=e,{getCashChange:r}=Object(m.a)(),i=e=>{"Enter"===e.key&&(e.preventDefault(),a())};return Object(n.useEffect)((()=>{const e=t.current;if(c&&e)return e.addEventListener("keydown",i),e.focus(),()=>{e.removeEventListener("keydown",i)}}),[c]),Object(x.jsx)(j.a,{centered:!0,width:450,footer:!1,onCancel:s,open:c,bodyStyle:{backgroundColor:"#f8f8f8"},children:Object(x.jsxs)("div",{autoFocus:!0,tabIndex:1,ref:t,className:"w-full h-48 flex items-center justify-center flex-col gap-3",children:[Object(x.jsx)("h1",{className:"text-lg font-medium text-gray-700",children:"KEMBALIAN PELANGGAN"}),Object(x.jsxs)("p",{className:"text-3xl font-bold",children:["Rp ",Object(u.a)(r(null===l||void 0===l?void 0:l.settles,null===l||void 0===l?void 0:l.cashPaid),0)]}),Object(x.jsx)(h.a,{className:"w-1/2 btn-page h-14 mt-7",onClick:a,children:"PRINT BILL"})]})})}function p(e){let{state:t}=e;const{getSubtotal:a,getDiscountTotal:l}=Object(m.a)();return Object(x.jsxs)("div",{className:"w-full h-full",children:[Object(x.jsx)("h1",{className:"text-base font-semibold",children:"Detail Transaksi"}),Object(x.jsx)("div",{className:"w-full bg-gray-400 mt-2 mb-2",style:{height:"1.5px"}}),Object(x.jsx)("table",{className:"w-full",children:Object(x.jsxs)("tbody",{children:[Object(x.jsxs)("tr",{className:"w-full h-6",children:[Object(x.jsx)("td",{className:"w-1/2 text-sm uppercase font-semibold text-gray-800",children:"Subtotal"}),Object(x.jsx)("td",{className:"text-sm uppercase font-medium text-gray-800",children:":"}),Object(x.jsxs)("td",{className:"w-1/2 pl-2 text-sm uppercase font-medium text-gray-800",children:["idr ",Object(u.a)(a(),0)]})]}),Object(x.jsxs)("tr",{className:"w-full h-6",children:[Object(x.jsx)("td",{className:"w-1/2 text-sm uppercase font-semibold text-gray-800",children:"Diskon"}),Object(x.jsx)("td",{className:"text-sm uppercase font-medium text-gray-800",children:":"}),Object(x.jsxs)("td",{className:"w-1/2 pl-2 text-sm uppercase font-medium text-gray-800",children:["idr ",Object(u.a)(l(),0)]})]}),Object(x.jsxs)("tr",{className:"w-full h-6",children:[Object(x.jsx)("td",{className:"w-1/2 text-sm uppercase font-semibold text-gray-800",children:"PPN 11%"}),Object(x.jsx)("td",{className:"text-sm uppercase font-medium text-gray-800",children:":"}),Object(x.jsx)("td",{className:"w-1/2 pl-2 text-sm uppercase font-medium text-gray-800",children:"idr 0"})]})]})})]})}a(242);var v=a(181);function O(e){var t,a;let{state:l,setState:c,handlePaymentList:r}=e;const[i]=s.a.useForm(),d=Object(n.useRef)(null),o=Object(n.useRef)(null),u=Object(n.useRef)(null),m=()=>{c((e=>({...e,modalCard:!1,modalCash:!1}))),i.resetFields()},b=e=>{"ArrowUp"===e.key&&p(),"ArrowDown"===e.key&&o.current&&document.activeElement===o.current.input&&(o&&o.current.blur(),u&&u.current.focus()),"Enter"===e.key&&o.current&&document.activeElement===o.current.input&&(o&&o.current.blur(),u&&u.current.focus())},p=()=>o&&o.current&&o.current.focus();return Object(n.useEffect)((()=>{p();if(d&&null!==d.current)return document.addEventListener("keydown",b),()=>{document.removeEventListener("keydown",b)}}),[null===l||void 0===l?void 0:l.modalCard,d]),Object(x.jsx)(j.a,{open:null===l||void 0===l?void 0:l.modalCard,onCancel:m,centered:!0,width:650,footer:null,children:Object(x.jsxs)("div",{ref:d,autoFocus:!0,onKeyDown:b,className:"w-full h-full",children:[Object(x.jsx)("h1",{className:"text-lg font-semibold mb-5",children:"MASUKKAN KARTU"}),Object(x.jsxs)(s.a,{layout:"vertical",onFinish:()=>{r(null===l||void 0===l?void 0:l.tender),m()},form:i,name:"card-form",children:[Object(x.jsx)(s.a.Item,{name:"cardName",label:Object(x.jsxs)("p",{children:["Nama Kartu / Provider ",Object(x.jsx)("kbd",{className:"kbd",children:"\u2191"})]}),rules:[{required:!0,message:"Wajib Diisi!"}],children:Object(x.jsx)(v.a,{autoFocus:!0,ref:o,placeholder:"Card Holder / Name",value:null===l||void 0===l||null===(t=l.card)||void 0===t?void 0:t.name,onChange:e=>{const t=e.target.value;c((e=>({...e,card:{...e.card,name:t}})))},className:"w-full h-14 rounded-md"})}),Object(x.jsx)(s.a.Item,{name:"cardNo",label:Object(x.jsxs)("p",{children:["Nomor Kartu ",Object(x.jsx)("kbd",{className:"kbd",children:"\u2193"})]}),rules:[{required:!0,message:"Wajib Diisi!"}],children:Object(x.jsx)(v.a,{ref:u,placeholder:"Card Number",value:null===l||void 0===l||null===(a=l.card)||void 0===a?void 0:a.no,onChange:e=>{const t=e.target.value;c((e=>({...e,card:{...e.card,no:t}})))},className:"w-full h-14 rounded-md"})}),Object(x.jsxs)("div",{className:"w-full h-auto p-3 bg-gray-100 rounded-md mb-5",children:["Gunakan ",Object(x.jsx)("b",{children:"\u2191"})," untuk mengisi ",Object(x.jsx)("b",{children:"Nama Kartu"}),", dan ",Object(x.jsx)("b",{children:"\u2193"})," mengisi ",Object(x.jsx)("b",{children:"Nomor Kartu"})]}),Object(x.jsx)(s.a.Item,{children:Object(x.jsxs)("div",{className:"w-full flex items-center justify-end gap-3",children:[Object(x.jsx)(h.a,{htmlType:"button",className:"h-14 px-5 rounded-md uppercase",onClick:m,children:"Batalkan"}),Object(x.jsx)(h.a,{htmlType:"submit",className:"btn-page h-12 w-max px-7",children:"Bayar"})]})})]})]})})}a(756);var f=a(763);function N(e){let{state:t,handleState:a,handleCancel:s,handlePaymentList:c}=e;const i=Object(n.useRef)(null),{data:d=[]}=Object(r.e)((e=>null===e||void 0===e?void 0:e.transaction)),{tender:o={},modalCash:u=!1,settles:h=[]}=t,m=e=>{const t=e.key;["1","2","3","4","5","6","7","8","9","0","Backspace","Delete"].includes(t)&&("Backspace"!==t&&"Delete"!==t||a("cashPaid",0),p())},b=e=>0===d.length?l.a.error({message:"Perhatian!",description:"Tidak ada transaksi, silahkan lakukan transaksi terlebih dahulu."}):0===+(null===t||void 0===t?void 0:t.cashPaid)||+(null===t||void 0===t?void 0:t.cashPaid)<0?l.a.error({message:"Perhatian!",description:"Nominal pembayaran tidak boleh 0 atau minus"}):2===+(null===o||void 0===o?void 0:o.paidType)?(i.current.blur(),e.target.blur(),a("modalCard",!0),void a("modalCash",!1)):(c(null===t||void 0===t?void 0:t.tender),void s()),p=()=>{i&&null!==i.current&&i.current.focus()};return Object(n.useEffect)((()=>{p()}),[]),Object(n.useEffect)((()=>{p()}),[u,o,h]),Object(n.useEffect)((()=>{if(u)return window.addEventListener("keydown",m),()=>{window.removeEventListener("keydown",m)}}),[u,i]),Object(x.jsxs)(j.a,{open:u,onOk:b,onCancel:s,centered:!0,width:650,children:[Object(x.jsx)("h1",{className:"text-lg font-semibold text-center mb-5",children:"INPUT NOMINAL PEMBAYARAN"}),Object(x.jsx)(f.a,{min:0,name:"cashPaid",ref:i,autoFocus:!0,className:"w-full h-32 p-5 flex items-center bg-transparent text-4xl text-black font-bold border-none focus:outline-none",placeholder:"MASUKKAN NOMINAL PEMBAYARAN",value:null===t||void 0===t?void 0:t.cashPaid,formatter:e=>"IDR ".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>null===e||void 0===e?void 0:e.replace(/IDR\s?|(,*)/g,""),onChange:e=>{a("cashPaid",e)},onPressEnter:e=>{b(e)}})]})}var g=a(198);function y(e){let{state:t,setState:a,handleFocus:l}=e;const[s,c]=Object(n.useState)(-1),r=Object(n.useRef)(null),i=(null===t||void 0===t?void 0:t.settles)||[],d=e=>{switch(e.key){case"F4":c(0),e.target.blur(),e.preventDefault(),r&&r.current.focus();break;case"F3":r&&r.current.blur()}},o=e=>{var t;switch(e.key){case"ArrowUp":c((e=>Math.max(e-1,0)));break;case"ArrowDown":c((e=>Math.min(e+1,i.length-1)));break;case"Enter":const a=null===(t=i[s])||void 0===t?void 0:t.settleCode;a&&j(a);break;case"Escape":e.target.blur(),l()}};Object(n.useEffect)((()=>(r.current&&r.current.focus(),document.addEventListener("keydown",d),()=>{document.removeEventListener("keydown",d)})),[]),Object(n.useEffect)((()=>{const e=r.current;if(e)return e.addEventListener("keydown",o),()=>{e.removeEventListener("keydown",o)}}),[i,s]);const j=e=>{const s=null===t||void 0===t?void 0:t.settles;a({settles:null===s||void 0===s?void 0:s.filter((t=>t.settleCode!==e))}),r.current.focus(),l()};return Object(x.jsxs)("div",{className:"w-full h-full relative",children:[Object(x.jsxs)("h1",{className:"mb-3 text-lg font-semibold",children:["Alokasi Pembayaran ",Object(x.jsx)("kbd",{className:"kbd",children:"F4"})]}),Object(x.jsxs)("table",{ref:r,tabIndex:0,className:"table-fixed w-full",border:!0,children:[Object(x.jsx)("thead",{className:"w-full h-14 bg-primary sticky top-0",children:Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{className:"w-10 text-center",children:"#"}),Object(x.jsx)("th",{className:"w-1/2 text-left px-3 text-white",children:"Payment Type"}),Object(x.jsx)("th",{className:"w-1/2 text-right px-3 text-white",children:"Amount"})]})}),Object(x.jsx)("tbody",{children:i.map(((e,t)=>{let{cashPay:a=0,tenderName:l="",settleCode:n=""}=e;return Object(x.jsxs)("tr",{className:"w-full h-14 border border-gray-500 ".concat(t===s?"bg-yellow-200":""),children:[Object(x.jsx)("td",{className:"w-10 text-center",children:Object(x.jsx)(h.a,{icon:Object(x.jsx)(g.c,{className:"text-white"}),type:"primary",className:"flex items-center justify-center mx-auto",shape:"circle",danger:!0,onClick:()=>j(n)})}),Object(x.jsx)("td",{className:"w-1/2 text-left px-3 text-black",children:l.trim().toUpperCase()}),Object(x.jsxs)("td",{className:"w-1/2 text-right px-3 text-black",children:["Rp ",Object(u.a)(a)]})]},n)}))})]})]})}var w=a(38);function k(e){let{form:t,state:a,setState:l,handleClickTender:s,handleFocus:c}=e;const i=Object(w.useHistory)(),{tenderMedia:d=[],data:o=[]}=Object(r.e)((e=>null===e||void 0===e?void 0:e.transaction)),{getGrandTotal:u}=Object(m.a)(),j=Object(n.useRef)(),b=Object(n.useRef)([]),[p,v]=Object(n.useState)(-1),O=()=>i.push("/pos/kasir"),f=e=>{const t=e.key;"F3"===t&&(e.preventDefault(),v(0),j&&j.current.focus()),"F4"===t&&(v(-1),j&&j.current.blur()),"Escape"===t&&(e.target.blur(),c()),"End"===t&&O()},N=e=>{const t=e.key;if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"].includes(t)){e.preventDefault();let a=p;const l=3;if("ArrowLeft"===t)p%l===0?a=p+(l+1):a-=1;else if("ArrowRight"===t)(p+1)%l===0?a=p-(l-1):a+=1;else if("ArrowUp"===t)p-l<0?a=(d.length-l+p%l)%d.length:a-=1;else if("ArrowDown"===t)p+l>=d.length?a=(d.length-l+p%l)%d.length:a+=1;else if("Enter"===t){b.current[a].disabled||s(d[p])}v(a),b.current[a]&&b.current[a].scrollIntoView({behavior:"smooth",block:"center"})}};return Object(n.useEffect)((()=>(document.addEventListener("keydown",f),0===o.length&&O(),()=>{document.removeEventListener("keydown",f)})),[]),Object(n.useEffect)((()=>{const e=j&&null!==j.current?j.current:null;if(e)return e.addEventListener("keydown",N),()=>{e.removeEventListener("keydown",N)}}),[p,d]),Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)("div",{ref:j,tabIndex:-1,id:"tender-media",className:"w-full h-full overflow-y-scroll overflow-x-hidden ",children:[Object(x.jsxs)("h1",{className:"mb-3 text-lg font-semibold",children:["Metode Pembayaran ",Object(x.jsx)("kbd",{className:"kbd",children:"f3"})]}),Object(x.jsxs)("div",{className:"w-full h-auto grid grid-cols-3 gap-3",children:[Object(x.jsxs)(h.a,{className:"col-span-3 btn-page bg-transparent border-2 border-red-500 text-red-600",onClick:O,children:["batalkan ",Object(x.jsx)("kbd",{className:"kbd",children:"end"})]}),0!==(null===d||void 0===d?void 0:d.length)&&(null===d||void 0===d?void 0:d.map(((e,t)=>{const{settleCode:l,tenderName:n}=e,c=0!==(null===a||void 0===a?void 0:a.settles.length)?null===a||void 0===a?void 0:a.settles.filter((e=>(null===e||void 0===e?void 0:e.settleCode)===l)):[],r=0!==(null===c||void 0===c?void 0:c.length)&&c[0].settleCode===l||0===(null===o||void 0===o?void 0:o.length)||0===u();return Object(x.jsx)(h.a,{ref:e=>b.current[t]=e,className:"btn-page ".concat(t===p?"active":""),disabled:r,onClick:()=>{if(r)return null;s(e)},onKeyDown:t=>{"Enter"!==t.key||r||s(e)},children:n.trim().toUpperCase()},l)})))]})]})})}function C(){var e;const t=Object(i.useHistory)(),a=Object(r.d)();let j=Object(n.useRef)(null);const{billNo:h="",data:v=[]}=Object(r.e)((e=>null===e||void 0===e?void 0:e.transaction)),{getSubtotal:f,getGrandTotal:g,getCashPaid:w,getCashChange:C,getBalanceDue:P,paymentStore:E}=Object(m.a)(),{cashier:S={}}=JSON.parse(localStorage.getItem("app")||"{}"),[T]=s.a.useForm(),[A,R]=Object(n.useState)({cashPaid:0,cashChange:0,card:{name:"",no:""},settles:[],subtotal:f(),grandTotal:g(),modalCash:!1,modalCard:!1,modalCashChange:!1,tender:{}}),D=e=>{const{settleCode:t="",tenderName:a="",paidType:s=""}=e,n=(null===A||void 0===A?void 0:A.settles)||[],c=C(n,null===A||void 0===A?void 0:A.cashPaid);if((null===A||void 0===A?void 0:A.cashPaid)>0){const e={billNo:h,custCode:"",custName:"",paidType:s,settleCode:t,amount:g(),amountPaid:(null===A||void 0===A?void 0:A.cashPaid)||0,cashPay:(null===A||void 0===A?void 0:A.cashPaid)||0,cashChange:c||0,tenderName:a,cardName:2===+s&&(null===A||void 0===A?void 0:A.card.name)||"",cardHolder:2===+s&&(null===A||void 0===A?void 0:A.card.name)||"",cardNo:2===+s?(null===A||void 0===A?void 0:A.card.no)||"0":""};return R((t=>({...t,settles:[...t.settles,e],cashPaid:0}))),void T.resetFields()}l.a.error({message:"Gagal!",description:"Nominal yang anda masukkan tidak boleh 0."})},L=Object(d.useReactToPrint)({content:()=>j,onPrintError:e=>console.log("Error Print!",e),onAfterPrint:()=>{a({type:o.a.SET_STATE,payload:{contentStatus:"isMenu"}}),t.push("/pos/kasir"),l.a.success({message:"Print!",description:"Cetak struk berhasil."})},removeAfterPrint:!0,copyStyles:!0}),I=()=>E(A,L(null,(()=>j))),M=e=>{e.key},F=()=>{a({type:"transaction/SET_STATE",payload:{contentStatus:"isMenu"}}),R((e=>({...e,cashPaid:0,modalCash:!1,modalCard:!1,modalCashChange:!1})))};return Object(n.useEffect)((()=>{a({type:"transaction/TENDER_MEDIA"}),null!==S&&void 0!==S&&S.isOpening||(t.push("/pos"),l.a.error({message:"Error!",description:"Mohon untuk melakukan Buka Kasir terlebih dahulu sebelum melanjutkan transaksi."}))}),[]),Object(n.useEffect)((()=>(document.addEventListener("keydown",M),()=>{document.removeEventListener("keydown",M)})),[]),Object(n.useEffect)((()=>{0===(null===v||void 0===v?void 0:v.length)||0===(null===A||void 0===A?void 0:A.settles.length)||(()=>{const e=(null===A||void 0===A?void 0:A.settles)||[],t=C(e,null===A||void 0===A?void 0:A.cashPaid),a=w(e),l=g();a>l&&t>0?R((e=>({...e,modalCashChange:!0}))):a!==l||I()})()}),[null===A||void 0===A?void 0:A.settles]),Object(x.jsxs)("div",{className:"w-screen h-screen overflow-x-hidden overflow-y-scroll",children:[Object(x.jsxs)("div",{className:"w-full h-full grid grid-cols-12 grid-rows-6 gap-3 p-3",children:[Object(x.jsx)("div",{className:"col-span-3 row-span-5 bg-white overflow-scroll p-3 rounded-md border-2 border-gray-400",children:Object(x.jsx)("div",{className:"w-full h-full",children:Object(x.jsx)(c.a,{ref:e=>j=e,transactions:v,cash:{cashChange:C(null===A||void 0===A?void 0:A.settles,null===A||void 0===A?void 0:A.cashPaid),cashPaid:w(null===A||void 0===A?void 0:A.settles),total:null===A||void 0===A?void 0:A.grandTotal},billDate:new Date,payments:null===A||void 0===A?void 0:A.settles,paymentMethod:null===A||void 0===A||null===(e=A.settles[0])||void 0===e?void 0:e.tenderName})})}),Object(x.jsxs)("div",{className:"col-span-9 row-span-1 bg-primary rounded-md",children:[Object(x.jsxs)("div",{className:"w-full h-full p-5 flex flex-row items-center justify-between gap-3",children:[Object(x.jsx)("h1",{className:"text-lg text-white",children:"Total Belanja"}),Object(x.jsxs)("h1",{className:"text-4xl text-white font-semibold capitalize",children:["Rp ",Object(u.a)(g(),0)]})]}),"."]}),Object(x.jsx)("div",{className:"col-span-9 row-span-1",children:Object(x.jsxs)("div",{className:"w-full h-full flex items-center gap-3",children:[Object(x.jsxs)("div",{className:"w-full h-full bg-white rounded-md p-3 flex flex-col items-center justify-center",children:[Object(x.jsx)("h1",{children:"Kembalian"}),Object(x.jsxs)("h1",{className:"text-2xl font-semibold capitalize",children:["IDR ",Object(u.a)(C(null===A||void 0===A?void 0:A.settles,null===A||void 0===A?void 0:A.cashPaid),0)]})]}),Object(x.jsxs)("div",{className:"w-full h-full bg-white rounded-md p-3 flex flex-col items-center justify-center",children:[Object(x.jsx)("h1",{children:"Sisa Bayar"}),Object(x.jsxs)("h1",{className:"text-2xl font-semibold capitalize",children:["IDR ",Object(u.a)(P(null===A||void 0===A?void 0:A.settles,null===A||void 0===A?void 0:A.cashPaid),0)]})]})]})}),Object(x.jsx)("div",{className:"col-span-9 row-span-6",children:Object(x.jsxs)("div",{className:"w-full h-full overflow-hidden grid grid-cols-2 gap-5",children:[Object(x.jsx)("div",{className:"w-full h-full overflow-scroll",children:Object(x.jsx)(k,{form:T,state:A,setState:R,handleClickTender:e=>{const{paidType:t=0}=e;if((null===v||void 0===v?void 0:v.length)<0)return l.a.warning({message:"Perhatian!",description:"Anda tidak dapat melakukan pembayaran jika tidak ada item yang dibeli."});R((t=>({...t,tender:e}))),1!==+t?2!==+t?+t>=6&&+t<8&&l.a.warning({message:"Perhatian!!!",description:"Fitur ini sedang dalam tahap pengembangan. Terima kasih"}):R((e=>({...e,modalCash:!0,cashPaid:P(null===A||void 0===A?void 0:A.settles,null===A||void 0===A?void 0:A.cashPaid)}))):R((e=>({...e,modalCash:!0})))},handleFocus:()=>{}})}),Object(x.jsx)("div",{className:"w-full h-full overflow-scroll",children:Object(x.jsx)(y,{state:A,setState:R,handleFocus:()=>{}})})]})}),Object(x.jsx)("div",{className:"col-span-3 row-span-4 bg-white border-2 border-gray-400 rounded-md overflow-scroll px-5 py-2",children:Object(x.jsx)(p,{state:A})})]}),Object(x.jsx)(N,{state:A,handleState:(e,t)=>{R((a=>({...a,[e]:t})))},handleCancel:F,handlePaymentList:D,handleFocus:()=>{}}),Object(x.jsx)(O,{state:A,setState:R,handlePaymentList:D,handleFocus:()=>{}}),Object(x.jsx)(b,{handlePaymentStore:I,open:null===A||void 0===A?void 0:A.modalCashChange,state:A,handleCancel:F})]})}}}]);
//# sourceMappingURL=22.9374ad7c.chunk.js.map