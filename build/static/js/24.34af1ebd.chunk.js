(this.webpackJsonpPOS_RETAIL=this.webpackJsonpPOS_RETAIL||[]).push([[24],{316:function(e,t,a){"use strict";a.d(t,"a",(function(){return j}));a(280);var l=a(282),s=(a(281),a(283)),n=a(148),c=a.n(n),r=a(1),i=a.n(r),d=a(48),o=a(85),u=a(13);const j=i.a.forwardRef(((e,t)=>{const{transactions:a=[],cash:n={},billDate:i="",billNo:j=null,paymentMethod:m="",isReprintBill:h=!1,payments:x=[],isPrintTest:b=!1}=e,[p,v]=Object(r.useState)({}),{billNo:O}=Object(d.e)((e=>null===e||void 0===e?void 0:e.transaction)),{loading:f=!1}=Object(d.e)((e=>null===e||void 0===e?void 0:e.auth));Object(r.useEffect)((()=>{const e=JSON.parse(localStorage.getItem("app")||"{}"),{property:t={},user:a={}}=e;v({...t,cashier:(null===a||void 0===a?void 0:a.username)||""}||{})}),[t]);const N=null===a||void 0===a?void 0:a.reduce(((e,t)=>{let{total:a=0}=t;return+e+ +a}),0),g=null===x||void 0===x?void 0:x.reduce(((e,t)=>{let{paidValue:a=0,cashPay:l=0,paidType:s}=t;return+e+ +(1===+s?l:a)}),0),y=g-N;return Object(u.jsx)("div",{className:"w-full h-full rounded-md mx-auto",children:Object(u.jsxs)("div",{className:"w-full h-auto bg-white p-3 py-7 mx-auto rounded-md",style:{maxWidth:"305px"},ref:t,children:[f?Object(u.jsx)("p",{className:"text-left text-print-xsmall text-gray-500",children:"Memuat data..."}):Object(u.jsxs)("div",{children:[Object(u.jsx)("p",{className:"text-center text-print-medium font-bold",children:(null===p||void 0===p?void 0:p.header1)||""}),Object(u.jsx)("p",{className:"text-center text-print-small font-semibold",children:(null===p||void 0===p?void 0:p.header2)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall mt-2",children:(null===p||void 0===p?void 0:p.header3)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:(null===p||void 0===p?void 0:p.header4)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:(null===p||void 0===p?void 0:p.header5)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:(null===p||void 0===p?void 0:p.header6)||""}),Object(u.jsx)("div",{className:"my-3 w-full border border-separate border-gray-400"}),h&&Object(u.jsx)("p",{className:"text-center text-print-small mt-3 font-semibold",children:"THIS IS COPY / REPRINT"}),b&&Object(u.jsx)("p",{className:"text-center text-print-small mt-3 font-semibold",children:"THIS IS PRINT TEST"})]}),b||h?Object(u.jsx)("div",{className:"my-3 w-full border border-separate border-gray-400"}):null,Object(u.jsxs)(l.a,{children:[Object(u.jsx)(s.a,{span:7,children:Object(u.jsx)("p",{className:"text-left text-print-xsmall",children:"Tanggal/Waktu"})}),Object(u.jsx)(s.a,{span:2,children:Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:":"})}),Object(u.jsx)(s.a,{span:15,children:Object(u.jsx)("p",{className:"text-left text-print-xsmall",children:c()(i).format("ddd, DD MMMM YYYY LTS")})})]}),Object(u.jsxs)(l.a,{className:"my-1",children:[Object(u.jsx)(s.a,{span:7,children:Object(u.jsx)("p",{className:"text-left text-print-xsmall",children:"No. Transaksi"})}),Object(u.jsx)(s.a,{span:2,children:Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:":"})}),Object(u.jsx)(s.a,{span:15,children:Object(u.jsx)("p",{className:"text-left text-print-xsmall",children:j||O||"-"})})]}),Object(u.jsxs)(l.a,{children:[Object(u.jsx)(s.a,{span:7,children:Object(u.jsx)("p",{className:"text-left text-print-xsmall",children:"Kasir"})}),Object(u.jsx)(s.a,{span:2,children:Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:":"})}),Object(u.jsx)(s.a,{span:15,children:Object(u.jsx)("p",{className:"text-left text-print-xsmall",children:(null===p||void 0===p?void 0:p.cashier)||""})})]}),Object(u.jsx)("div",{className:"my-3 w-full border border-separate border-gray-400"}),0===(null===a||void 0===a?void 0:a.length)&&Object(u.jsx)("p",{className:"text-left text-print-xsmall text-gray-500",children:"Tidak ada transaksi"}),null===a||void 0===a?void 0:a.map(((e,t)=>{let{ItemName:a="",qty:n=0,price:c=0,total:r=0}=e;return Object(u.jsxs)(l.a,{wrap:!0,gutter:[2,2],className:"mb-2",children:[Object(u.jsx)(s.a,{span:24,children:Object(u.jsx)("p",{className:"text-left text-print-xsmall",children:a||""})}),Object(u.jsx)(s.a,{span:8,children:Object(u.jsxs)("p",{className:"text-left text-print-xsmall",children:["Rp ",Object(o.a)(c||0,0)||""]})}),Object(u.jsx)(s.a,{span:8,children:Object(u.jsxs)("p",{className:"text-center text-print-xsmall",children:[n||"","x"]})}),Object(u.jsx)(s.a,{span:8,children:Object(u.jsxs)("p",{className:"text-right text-print-xsmall",children:["Rp ",Object(o.a)((r||0).toString(),0)||"0"]})})]},t)})),Object(u.jsx)("div",{className:"my-3 w-full border border-separate border-gray-400"}),0===(null===x||void 0===x?void 0:x.length)?Object(u.jsxs)(l.a,{className:"my-1",children:[Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall",children:"Pembayaran"})}),Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall uppercase",children:(m||"-").trim().toUpperCase()})})]}):null===x||void 0===x?void 0:x.map(((e,t)=>{var a,n;let{cashPay:c,tenderName:r,paidType:i,paidValue:d}=e;return Object(u.jsxs)(l.a,{className:"my-1",children:[Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall capitalize",children:null===(a=r||"")||void 0===a?void 0:a.trim()})}),Object(u.jsx)(s.a,{span:12,children:Object(u.jsxs)("p",{className:"text-right text-print-xsmall uppercase",children:["Rp ",null===(n=Object(o.a)(1===+i?c:d,0)||"")||void 0===n?void 0:n.trim()]})})]})})),Object(u.jsxs)(l.a,{className:"my-1",children:[Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall",children:"Subtotal"})}),Object(u.jsx)(s.a,{span:12,children:Object(u.jsxs)("p",{className:"text-right text-print-xsmall",children:["Rp ",Object(o.a)(N||"0",0)]})})]}),Object(u.jsxs)(l.a,{className:"my-1",children:[Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall",children:"Diskon"})}),Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall",children:"Rp 0"})})]}),Object(u.jsxs)(l.a,{className:"my-1",children:[Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall",children:"Total"})}),Object(u.jsx)(s.a,{span:12,children:Object(u.jsxs)("p",{className:"text-right text-print-xsmall",children:["Rp ",Object(o.a)(N||"0",0)]})})]}),Object(u.jsxs)(l.a,{className:"my-1",children:[Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall",children:"Bayar"})}),Object(u.jsx)(s.a,{span:12,children:Object(u.jsxs)("p",{className:"text-right text-print-xsmall",children:["Rp ",Object(o.a)(g||"0",0)]})})]}),Object(u.jsxs)(l.a,{className:"my-1",children:[Object(u.jsx)(s.a,{span:12,children:Object(u.jsx)("p",{className:"text-right text-print-xsmall",children:"Kembalian"})}),Object(u.jsx)(s.a,{span:12,children:Object(u.jsxs)("p",{className:"text-right text-print-xsmall",children:["Rp ",Object(o.a)(y||"0",0)]})})]}),f?Object(u.jsx)("p",{className:"text-left text-print-xsmall text-gray-500",children:"Memuat data..."}):Object(u.jsxs)("div",{className:"mt-7",children:[Object(u.jsx)("p",{className:"text-center text-print-xsmall font-semibold",children:(null===p||void 0===p?void 0:p.footer1)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:(null===p||void 0===p?void 0:p.footer2)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:(null===p||void 0===p?void 0:p.footer3)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:(null===p||void 0===p?void 0:p.footer4)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:(null===p||void 0===p?void 0:p.footer5)||""}),Object(u.jsx)("p",{className:"text-center text-print-xsmall",children:(null===p||void 0===p?void 0:p.footer6)||""})]})]})})}))},317:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var l=a(48),s=a(28);function n(){const e=Object(l.d)(),t=Object(s.useHistory)(),{billNo:a="",billDate:n="",data:c=[]}=Object(l.e)((e=>null===e||void 0===e?void 0:e.transaction)),{cashier:r={},property:i={}}=JSON.parse(localStorage.getItem("app")||"{}"),d=()=>(null===c||void 0===c?void 0:c.reduce(((e,t)=>{let{total:a=0}=t;return+e+ +a}),0))||0,o=()=>0,u=()=>d()-0,j=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return 0!==(null===e||void 0===e?void 0:e.length)?e.reduce(((e,t)=>+e+ +t.amountPaid),0):0},m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const a=u(),l=j(e);return 0===a?0:t>a?t-a:l>a?l-a:0};return{getTotalQty:()=>(null===c||void 0===c?void 0:c.reduce(((e,t)=>{let{qty:a=0}=t;return+e+ +a}),0))||0,getDiscountTotal:o,getSubtotal:d,getGrandTotal:u,getCashPaid:j,getCashChange:m,getBalanceDue:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=m(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),a=j(e),l=u();return a>=l?a-l-t:u()-+a},paymentStore:(l,s)=>{var o,j;const h={header:[{billNo:a,billDate:n,custCode:"",custName:"",discPrc:"0",discValue:"0",taxPrc:"0",taxValue:"0",subTotal:d(),grandTotal:u(),shiftID:(null===r||void 0===r?void 0:r.shiftId)||"0",outletCode:null===i||void 0===i?void 0:i.outletCode}],settle:0!==(null===(o=l.settles)||void 0===o?void 0:o.length)&&(null===(j=l.settles)||void 0===j?void 0:j.map((e=>{const t=e.cashPay,a=m(null===l||void 0===l?void 0:l.settles,null===e||void 0===e?void 0:e.cashPay),s=+(null===e||void 0===e?void 0:e.paidType);return{...e,cashChange:1===s?a:0,amount:1===s?t-a:null===e||void 0===e?void 0:e.amount,amountPaid:1===s?t-a:null===e||void 0===e?void 0:e.amountPaid}}))),details:null===c||void 0===c?void 0:c.map(((e,t)=>({...e,billNo:a,ItemNo:t+1})))};e({type:"transaction/STORE",payload:h,bill:{from:n,to:n},handlePrint:()=>{if("function"===typeof s)return s()},history:t})}}}},465:function(e,t,a){},833:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return k}));a(100);var l=a(17),s=(a(197),a(86)),n=a(1),c=a(316),r=a(48),i=a(339),d=a(329),o=(a(10),a(85)),u=(a(465),a(150),a(72)),j=(a(110),a(64)),m=a(317),h=a(13);function x(e){const t=Object(n.useRef)(),{handlePaymentStore:a=e=>{},state:l={},handleCancel:s=()=>{},open:c=!1}=e,{getCashChange:r}=Object(m.a)(),i=()=>{t&&null!==t.current&&t.current&&t.current.focus()},d=e=>{"Enter"===e.key&&(e.preventDefault(),a())};return Object(n.useEffect)((()=>{const e=t&&null!==t.current&&t.current;if(e)return i(),e.addEventListener("keydown",d),()=>{e.removeEventListener("keydown",d)}}),[t]),Object(n.useEffect)((()=>{i()}),[c]),Object(h.jsx)(u.a,{centered:!0,width:475,footer:!1,onCancel:s,open:c,bodyStyle:{backgroundColor:"#f8f8f8"},children:Object(h.jsxs)("div",{autoFocus:!0,tabIndex:1,ref:t,onKeyDown:d,className:"w-full h-60 flex items-center justify-center flex-col gap-3",children:[Object(h.jsx)("h1",{className:"text-lg font-medium text-gray-700",children:"KEMBALIAN PELANGGAN"}),Object(h.jsxs)("p",{className:"text-3xl font-bold",children:["Rp ",Object(o.a)(r(null===l||void 0===l?void 0:l.settles,null===l||void 0===l?void 0:l.cashPaid),0)]}),Object(h.jsx)(j.a,{className:"w-1/2 btn-page h-14 mt-7",onClick:a,children:"PRINT BILL"}),Object(h.jsxs)("p",{className:"text-center text-base",children:["Untuk melakukan cetak struk, anda dapat ",Object(h.jsx)("b",{children:"KLIK"})," tombol diatas, ataupun tekan ",Object(h.jsx)("b",{children:"ENTER"})]})]})})}function b(e){let{state:t}=e;const{getSubtotal:a,getDiscountTotal:l}=Object(m.a)();return Object(h.jsxs)("div",{className:"w-full h-full",children:[Object(h.jsx)("h1",{className:"text-base font-semibold",children:"Detail Transaksi"}),Object(h.jsx)("div",{className:"w-full bg-gray-400 mt-2 mb-2",style:{height:"1.5px"}}),Object(h.jsx)("table",{className:"w-full",children:Object(h.jsxs)("tbody",{children:[Object(h.jsxs)("tr",{className:"w-full h-6",children:[Object(h.jsx)("td",{className:"w-1/2 text-sm uppercase font-semibold text-gray-800",children:"Subtotal"}),Object(h.jsx)("td",{className:"text-sm uppercase font-medium text-gray-800",children:":"}),Object(h.jsxs)("td",{className:"w-1/2 pl-2 text-sm uppercase font-medium text-gray-800",children:["idr ",Object(o.a)(a(),0)]})]}),Object(h.jsxs)("tr",{className:"w-full h-6",children:[Object(h.jsx)("td",{className:"w-1/2 text-sm uppercase font-semibold text-gray-800",children:"Diskon"}),Object(h.jsx)("td",{className:"text-sm uppercase font-medium text-gray-800",children:":"}),Object(h.jsxs)("td",{className:"w-1/2 pl-2 text-sm uppercase font-medium text-gray-800",children:["idr ",Object(o.a)(l(),0)]})]}),Object(h.jsxs)("tr",{className:"w-full h-6",children:[Object(h.jsx)("td",{className:"w-1/2 text-sm uppercase font-semibold text-gray-800",children:"PPN 11%"}),Object(h.jsx)("td",{className:"text-sm uppercase font-medium text-gray-800",children:":"}),Object(h.jsx)("td",{className:"w-1/2 pl-2 text-sm uppercase font-medium text-gray-800",children:"idr 0"})]})]})})]})}a(196);var p=a(140);function v(e){var t,a;let{state:l,setState:c,handlePaymentList:r}=e;const[i]=s.a.useForm(),d=Object(n.useRef)(null),o=Object(n.useRef)(null),m=Object(n.useRef)(null),x=()=>{c((e=>({...e,modalCard:!1,modalCash:!1}))),i.resetFields(),o&&o.current.blur(),m&&m.current.blur()},b=e=>{"ArrowUp"===e.key&&v(),"ArrowDown"===e.key&&o.current&&document.activeElement===o.current.input&&(o&&o.current.blur(),m&&m.current.focus()),"Enter"===e.key&&o.current&&document.activeElement===o.current.input&&(o&&o.current.blur(),m&&m.current.focus())},v=()=>o&&o.current&&o.current.focus();return Object(n.useEffect)((()=>(v(),document.addEventListener("keydown",b),()=>{document.removeEventListener("keydown",b)})),[null===l||void 0===l?void 0:l.modalCard]),Object(n.useEffect)((()=>{v()}),[o]),Object(h.jsx)(u.a,{open:null===l||void 0===l?void 0:l.modalCard,onCancel:x,centered:!0,width:650,footer:null,children:Object(h.jsxs)("div",{ref:d,className:"w-full h-full",children:[Object(h.jsx)("h1",{className:"text-lg font-semibold mb-5",children:"MASUKKAN KARTU"}),Object(h.jsxs)(s.a,{layout:"vertical",onFinish:()=>{r(null===l||void 0===l?void 0:l.tender),x()},form:i,name:"card-form",children:[Object(h.jsx)(s.a.Item,{autoFocus:!0,name:"cardName",label:Object(h.jsx)("p",{children:"Nama Kartu / Pemilik"}),rules:[{required:!0,message:"Wajib Diisi!"}],children:Object(h.jsx)(p.a,{autoFocus:!0,ref:o,placeholder:"John Doe",value:null===l||void 0===l||null===(t=l.card)||void 0===t?void 0:t.name,onChange:e=>{const t=e.target.value;c((e=>({...e,card:{...e.card,name:t}})))},className:"w-full h-14 rounded-md"})}),Object(h.jsx)(s.a.Item,{name:"cardNo",label:Object(h.jsx)("p",{children:"Nomor Kartu"}),rules:[{required:!0,message:"Wajib Diisi!"}],children:Object(h.jsx)(p.a,{ref:m,placeholder:"0001881923",value:null===l||void 0===l||null===(a=l.card)||void 0===a?void 0:a.no,onChange:e=>{const t=e.target.value;c((e=>({...e,card:{...e.card,no:t}})))},className:"w-full h-14 rounded-md"})}),Object(h.jsxs)("div",{className:"w-full h-auto p-3 bg-gray-100 rounded-md mb-5",children:["Gunakan ",Object(h.jsx)("b",{children:"\u2191"})," untuk mengisi ",Object(h.jsx)("b",{children:"Nama Kartu"}),", dan ",Object(h.jsx)("b",{children:"\u2193"})," mengisi ",Object(h.jsx)("b",{children:"Nomor Kartu"})]}),Object(h.jsx)(s.a.Item,{children:Object(h.jsxs)("div",{className:"w-full flex items-center justify-end gap-3",children:[Object(h.jsx)(j.a,{htmlType:"button",className:"h-14 px-5 rounded-md uppercase",onClick:x,children:"Batalkan"}),Object(h.jsx)(j.a,{htmlType:"submit",className:"btn-page h-12 w-max px-7",children:"Bayar"})]})})]})]})})}a(747);var O=a(818);function f(e){let{state:t,handleState:a,handleCancel:s,handlePaymentList:c}=e;const i=Object(n.useRef)(null),{data:d=[]}=Object(r.e)((e=>null===e||void 0===e?void 0:e.transaction)),{tender:o={},modalCash:j=!1}=t,m=e=>{const t=e.key;["1","2","3","4","5","6","7","8","9","0","Backspace","Delete","ArrowDown","ArrowUp"].includes(t)&&(b(),"Backspace"!==t&&"Delete"!==t||a("cashPaid",0),"ArrowUp"!==t&&"ArrowDown"!==t||(p(),e.preventDefault()))},x=e=>0===d.length?l.a.error({message:"Perhatian!",description:"Tidak ada transaksi, silahkan lakukan transaksi terlebih dahulu."}):0===+(null===t||void 0===t?void 0:t.cashPaid)||+(null===t||void 0===t?void 0:t.cashPaid)<0?l.a.error({message:"Perhatian!",description:"Nominal pembayaran tidak boleh 0 atau minus"}):2===+(null===o||void 0===o?void 0:o.paidType)?(i.current.blur(),e.target.blur(),a("modalCard",!0),void a("modalCash",!1)):(c(null===t||void 0===t?void 0:t.tender),void s()),b=()=>{i&&null!==i.current&&i.current.focus()},p=()=>{i&&null!==i.current&&(i.current.focus(),i.current.select())};return Object(n.useEffect)((()=>(j&&p(),document.addEventListener("keydown",m),()=>{document.removeEventListener("keydown",m)})),[j]),Object(n.useEffect)((()=>{b()}),[j,t]),Object(h.jsxs)(u.a,{open:j,onOk:x,onCancel:s,centered:!0,width:650,children:[Object(h.jsx)("h1",{className:"text-lg font-semibold text-center mb-5",children:"INPUT NOMINAL PEMBAYARAN"}),Object(h.jsx)(O.a,{min:0,name:"cashPaid",ref:i,autoFocus:!0,className:"w-full h-32 p-5 flex items-center bg-transparent text-4xl text-black font-bold border-none focus:bg-red-500",placeholder:"MASUKKAN NOMINAL PEMBAYARAN",value:null===t||void 0===t?void 0:t.cashPaid,formatter:e=>"IDR ".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>null===e||void 0===e?void 0:e.replace(/IDR\s?|(,*)/g,""),onChange:e=>{a("cashPaid",e),b()},onPressEnter:e=>{x(e)},onClick:()=>{p()},onFocus:()=>{b()},onKeyDown:e=>{const t=e.key;"ArrowUp"!==t&&"ArrowDown"!==t||e.preventDefault()}})]})}var N=a(467);function g(e){let{state:t,setState:a,handleFocus:l}=e;const[s,c]=Object(n.useState)(-1),r=Object(n.useRef)(null),i=(null===t||void 0===t?void 0:t.settles)||[],d=e=>{switch(e.key){case"F4":c(0),e.target.blur(),e.preventDefault(),r&&r.current.focus();break;case"F3":r&&r.current.blur()}},u=e=>{var t;switch(e.key){case"ArrowUp":c((e=>Math.max(e-1,0)));break;case"ArrowDown":c((e=>Math.min(e+1,i.length-1)));break;case"Enter":const a=null===(t=i[s])||void 0===t?void 0:t.settleCode;a&&m(a);break;case"Escape":e.target.blur(),l()}};Object(n.useEffect)((()=>(r.current&&r.current.focus(),document.addEventListener("keydown",d),()=>{document.removeEventListener("keydown",d)})),[]),Object(n.useEffect)((()=>{const e=r.current;if(e)return e.addEventListener("keydown",u),()=>{e.removeEventListener("keydown",u)}}),[i,s]);const m=e=>{const s=null===t||void 0===t?void 0:t.settles;a({settles:null===s||void 0===s?void 0:s.filter((t=>t.settleCode!==e))}),r.current.focus(),l()};return Object(h.jsxs)("div",{className:"w-full h-full relative",children:[Object(h.jsxs)("h1",{className:"mb-3 text-lg font-semibold",children:["Alokasi Pembayaran ",Object(h.jsx)("kbd",{className:"kbd",children:"F4"})]}),Object(h.jsxs)("table",{ref:r,tabIndex:0,className:"table-fixed w-full",border:!0,children:[Object(h.jsx)("thead",{className:"w-full h-14 bg-primary sticky top-0",children:Object(h.jsxs)("tr",{children:[Object(h.jsx)("th",{className:"w-10 text-center",children:"#"}),Object(h.jsx)("th",{className:"w-1/2 text-left px-3 text-white",children:"Payment Type"}),Object(h.jsx)("th",{className:"w-1/2 text-right px-3 text-white",children:"Amount"})]})}),Object(h.jsx)("tbody",{children:i.map(((e,t)=>{let{cashPay:a=0,tenderName:l="",settleCode:n="",amountPaid:c}=e;return Object(h.jsxs)("tr",{className:"w-full h-14 border border-gray-500 ".concat(t===s?"bg-yellow-200":""),children:[Object(h.jsx)("td",{className:"w-10 text-center",children:Object(h.jsx)(j.a,{icon:Object(h.jsx)(N.b,{className:"text-white"}),type:"primary",className:"flex items-center justify-center mx-auto",shape:"circle",danger:!0,onClick:()=>m(n)})}),Object(h.jsx)("td",{className:"w-1/2 text-left px-3 text-black",children:l.trim().toUpperCase()}),Object(h.jsxs)("td",{className:"w-1/2 text-right px-3 text-black",children:["Rp ",Object(o.a)(c)]})]},n)}))})]})]})}var y=a(28);function w(e){let{form:t,state:a,setState:l,handleClickTender:s,handleFocus:c}=e;const i=Object(y.useHistory)(),{tenderMedia:d=[],data:o=[]}=Object(r.e)((e=>null===e||void 0===e?void 0:e.transaction)),{getGrandTotal:u}=Object(m.a)(),x=Object(n.useRef)(),b=Object(n.useRef)([]),[p,v]=Object(n.useState)(-1),O=()=>i.push("/pos/kasir"),f=e=>{const t=e.key;"F3"===t&&(e.preventDefault(),v(0),x&&x.current.focus()),"F4"===t&&(v(-1),x&&x.current.blur()),"Escape"===t&&(e.target.blur(),c()),"End"===t&&O()},N=e=>{const t=e.key;if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"].includes(t)){e.preventDefault();let a=p;const l=3;if("ArrowLeft"===t)p%l===0?a=p+(l+1):a-=1;else if("ArrowRight"===t)(p+1)%l===0?a=p-(l-1):a+=1;else if("ArrowUp"===t)p-l<0?a=(d.length-l+p%l)%d.length:a-=1;else if("ArrowDown"===t)p+l>=d.length?a=(d.length-l+p%l)%d.length:a+=1;else if("Enter"===t){b.current[a]&&b.current[a].disabled||s(d[p])}v(a),b.current[a]&&b.current[a].scrollIntoView({behavior:"smooth",block:"center"})}};return Object(n.useEffect)((()=>(document.addEventListener("keydown",f),0===o.length&&O(),()=>{document.removeEventListener("keydown",f)})),[]),Object(n.useEffect)((()=>{const e=x&&null!==x.current?x.current:null;if(e)return e.addEventListener("keydown",N),()=>{e.removeEventListener("keydown",N)}}),[p,d]),Object(h.jsx)(h.Fragment,{children:Object(h.jsxs)("div",{ref:x,tabIndex:-1,id:"tender-media",className:"w-full h-full overflow-y-scroll overflow-x-hidden ",children:[Object(h.jsxs)("h1",{className:"mb-3 text-lg font-semibold",children:["Metode Pembayaran ",Object(h.jsx)("kbd",{className:"kbd",children:"f3"})]}),Object(h.jsxs)("div",{className:"w-full h-auto grid grid-cols-3 gap-3",children:[Object(h.jsxs)(j.a,{className:"col-span-3 btn-page bg-transparent border-2 border-red-500 text-red-600",onClick:O,children:["batalkan ",Object(h.jsx)("kbd",{className:"kbd",children:"end"})]}),0!==(null===d||void 0===d?void 0:d.length)&&(null===d||void 0===d?void 0:d.map(((e,t)=>{const{settleCode:l,tenderName:n}=e,c=0!==(null===a||void 0===a?void 0:a.settles.length)?null===a||void 0===a?void 0:a.settles.filter((e=>(null===e||void 0===e?void 0:e.settleCode)===l)):[],r=0!==(null===c||void 0===c?void 0:c.length)&&c[0].settleCode===l||0===(null===o||void 0===o?void 0:o.length)||0===u();return Object(h.jsx)(j.a,{ref:e=>b.current[t]=e,className:"btn-page ".concat(t===p?"active":""),disabled:r,onClick:()=>{if(r)return null;s(e)},onKeyDown:t=>{"Enter"!==t.key||r||s(e)},children:n.trim().toUpperCase()},l)})))]})]})})}function k(){var e;const t=Object(i.useHistory)(),a=Object(r.d)();let u=Object(n.useRef)(null);const{billNo:j="",data:p=[]}=Object(r.e)((e=>null===e||void 0===e?void 0:e.transaction)),{getSubtotal:O,getGrandTotal:N,getCashPaid:y,getCashChange:k,getBalanceDue:P,paymentStore:C}=Object(m.a)(),{cashier:E={}}=JSON.parse(localStorage.getItem("app")||"{}"),[T]=s.a.useForm(),[S,A]=Object(n.useState)({cashPaid:0,cashChange:0,card:{name:"",no:""},settles:[],subtotal:O(),grandTotal:N(),modalCash:!1,modalCard:!1,modalCashChange:!1,tender:{}}),D=e=>{const{settleCode:t="",tenderName:a="",paidType:s=""}=e,n=(null===S||void 0===S?void 0:S.settles)||[],c=k(n,null===S||void 0===S?void 0:S.cashPaid);if((null===S||void 0===S?void 0:S.cashPaid)>0){const e={billNo:j,custCode:"",custName:"",paidType:s,settleCode:t,amount:(null===S||void 0===S?void 0:S.cashPaid)||0,amountPaid:(null===S||void 0===S?void 0:S.cashPaid)||0,paidValue:(null===S||void 0===S?void 0:S.cashPaid)||0,cashPay:2===+s?0:(null===S||void 0===S?void 0:S.cashPaid)||0,cashChange:2===+s?0:c||0,tenderName:a,cardName:2===+s&&(null===S||void 0===S?void 0:S.card.name)||"",cardHolder:2===+s&&(null===S||void 0===S?void 0:S.card.name)||"",cardNo:2===+s?(null===S||void 0===S?void 0:S.card.no)||"0":""};return A((t=>({...t,settles:[...t.settles,e],cashPaid:0}))),void T.resetFields()}l.a.error({message:"Gagal!",description:"Nominal yang anda masukkan tidak boleh 0."})},R=Object(d.useReactToPrint)({content:()=>u.current,onPrintError:e=>console.log("Error Print!",e),onAfterPrint:()=>{l.a.success({message:"Print!",description:"Cetak struk berhasil."})}}),I=()=>C(S,R(null,(()=>u))),L=()=>{a({type:"transaction/SET_STATE",payload:{contentStatus:"isMenu"}}),A((e=>({...e,cashPaid:0,modalCash:!1,modalCard:!1,modalCashChange:!1})))};return Object(n.useEffect)((()=>{a({type:"transaction/TENDER_MEDIA"}),null!==E&&void 0!==E&&E.isOpening||(t.push("/pos"),l.a.error({message:"Error!",description:"Mohon untuk melakukan Buka Kasir terlebih dahulu sebelum melanjutkan transaksi."}))}),[]),Object(n.useEffect)((()=>{0===(null===p||void 0===p?void 0:p.length)||0===(null===S||void 0===S?void 0:S.settles.length)||(()=>{const e=(null===S||void 0===S?void 0:S.settles)||[],t=k(e,null===S||void 0===S?void 0:S.cashPaid),a=y(e),l=N();a>l&&t>0?A((e=>({...e,modalCashChange:!0}))):a!==l||I()})()}),[null===S||void 0===S?void 0:S.settles]),Object(h.jsxs)("div",{className:"w-screen h-screen overflow-x-hidden overflow-y-scroll",children:[Object(h.jsxs)("div",{className:"w-full h-full grid grid-cols-12 grid-rows-6 gap-3 p-3",children:[Object(h.jsx)("div",{className:"col-span-3 row-span-5 bg-white overflow-scroll p-3 rounded-md border-2 border-gray-400",children:Object(h.jsx)("div",{className:"w-full h-full",children:Object(h.jsx)(c.a,{ref:e=>u=e,transactions:p,cash:{cashChange:k(null===S||void 0===S?void 0:S.settles,null===S||void 0===S?void 0:S.cashPaid),cashPaid:y(null===S||void 0===S?void 0:S.settles),total:null===S||void 0===S?void 0:S.grandTotal},billDate:new Date,payments:null===S||void 0===S?void 0:S.settles,paymentMethod:null===S||void 0===S||null===(e=S.settles[0])||void 0===e?void 0:e.tenderName})})}),Object(h.jsxs)("div",{className:"col-span-9 row-span-1 bg-primary rounded-md",children:[Object(h.jsxs)("div",{className:"w-full h-full p-5 flex flex-row items-center justify-between gap-3",children:[Object(h.jsx)("h1",{className:"text-lg text-white",children:"Total Belanja"}),Object(h.jsxs)("h1",{className:"text-4xl text-white font-semibold capitalize",children:["Rp ",Object(o.a)(N(),0)]})]}),"."]}),Object(h.jsx)("div",{className:"col-span-9 row-span-1",children:Object(h.jsxs)("div",{className:"w-full h-full flex items-center gap-3",children:[Object(h.jsxs)("div",{className:"w-full h-full bg-white rounded-md p-3 flex flex-col items-center justify-center",children:[Object(h.jsx)("h1",{children:"Kembalian"}),Object(h.jsxs)("h1",{className:"text-2xl font-semibold capitalize",children:["IDR ",Object(o.a)(k(null===S||void 0===S?void 0:S.settles,null===S||void 0===S?void 0:S.cashPaid),0)]})]}),Object(h.jsxs)("div",{className:"w-full h-full bg-white rounded-md p-3 flex flex-col items-center justify-center",children:[Object(h.jsx)("h1",{children:"Sisa Bayar"}),Object(h.jsxs)("h1",{className:"text-2xl font-semibold capitalize",children:["IDR ",Object(o.a)(P(null===S||void 0===S?void 0:S.settles,null===S||void 0===S?void 0:S.cashPaid),0)]})]})]})}),Object(h.jsx)("div",{className:"col-span-9 row-span-6",children:Object(h.jsxs)("div",{className:"w-full h-full overflow-hidden grid grid-cols-2 gap-5",children:[Object(h.jsx)("div",{className:"w-full h-full overflow-scroll",children:Object(h.jsx)(w,{form:T,state:S,setState:A,handleClickTender:e=>{const{paidType:t=0}=e;if((null===p||void 0===p?void 0:p.length)<0)return l.a.warning({message:"Perhatian!",description:"Anda tidak dapat melakukan pembayaran jika tidak ada item yang dibeli."});A((t=>({...t,tender:e}))),1!==+t?2!==+t?+t>=6&&+t<8&&l.a.warning({message:"Perhatian!!!",description:"Fitur ini sedang dalam tahap pengembangan. Terima kasih"}):A((e=>({...e,modalCash:!0,cashPaid:P(null===S||void 0===S?void 0:S.settles,null===S||void 0===S?void 0:S.cashPaid)}))):A((e=>({...e,modalCash:!0})))},handleFocus:()=>{}})}),Object(h.jsx)("div",{className:"w-full h-full overflow-scroll",children:Object(h.jsx)(g,{state:S,setState:A,handleFocus:()=>{}})})]})}),Object(h.jsx)("div",{className:"col-span-3 row-span-4 bg-white border-2 border-gray-400 rounded-md overflow-scroll px-5 py-2",children:Object(h.jsx)(b,{state:S})})]}),Object(h.jsx)(f,{state:S,handleState:(e,t)=>{A((a=>({...a,[e]:t})))},handleCancel:L,handlePaymentList:D,handleFocus:()=>{}}),Object(h.jsx)(v,{state:S,setState:A,handlePaymentList:D,handleFocus:()=>{}}),Object(h.jsx)(x,{handlePaymentStore:I,open:null===S||void 0===S?void 0:S.modalCashChange,state:S,handleCancel:L})]})}}}]);
//# sourceMappingURL=24.34af1ebd.chunk.js.map